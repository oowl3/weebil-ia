generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ==========================================
// MÓDULO DE AUTENTICACIÓN (PERSONALIZADO)
// ==========================================

model UsuarioToken {
  id       BigInt   @id @default(autoincrement()) // BigInt solicitado
  token    String   @unique
  creadoEn DateTime @default(now())

  // Relación 1 a 1: Un token pertenece a un solo usuario
  usuarioId String @unique
  usuario   User   @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@map("usuario_tokens")
}

model User {
  id    String  @id @default(cuid())
  name  String?
  email String? @unique

  // Relación con Auth
  tokenSesion UsuarioToken?

  // Relación con Negocio (Pokedex)
  animalesDesbloqueados AnimalDesbloqueado[]

  @@map("users")
}

// ==========================================
// MÓDULO ARACNOSCAN (LÓGICA DE NEGOCIO)
// ==========================================

model Animal {
  id               Int      @id @default(autoincrement())
  nombreComun      String
  nombreCientifico String?
  descripcion      String?
  habitat          String?
  primerosAuxilios String?
  rutaImagen       String?
  creadoEn         DateTime @default(now())

  // Nuevos Campos de Clasificación (Ints)
  // Peligrosidad: 1=Verde, 2=Amarillo, 3=Rojo (Peligroso)
  peligrosidad Int @default(1)
  // Categoria: 1=Araña, 2=Reptil, etc.
  categoria    Int @default(1)

  // Relaciones
  animalAntidoto  AnimalAntidoto[]
  desbloqueadoPor AnimalDesbloqueado[]

  @@map("animales")
}

// Tabla Intermedia para la "Colección/Pokedex" del usuario
model AnimalDesbloqueado {
  usuarioId      String
  animalId       Int
  desbloqueadoEn DateTime @default(now())

  usuario User   @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  animal  Animal @relation(fields: [animalId], references: [id], onDelete: Cascade)

  @@id([usuarioId, animalId]) // Clave compuesta para no repetir desbloqueos
  @@map("animales_desbloqueados")
}

model Antidoto {
  id          Int      @id @default(autoincrement())
  nombre      String   @unique
  descripcion String?
  creadoEn    DateTime @default(now())

  animalAntidoto   AnimalAntidoto[]
  hospitalAntidoto HospitalAntidoto[]

  @@map("antidotos")
}

// Relación Animal <-> Antídoto (Qué cura a qué)
model AnimalAntidoto {
  animalId   Int
  antidotoId Int

  animal   Animal   @relation(fields: [animalId], references: [id], onDelete: Cascade)
  antidoto Antidoto @relation(fields: [antidotoId], references: [id], onDelete: Cascade)

  @@id([animalId, antidotoId])
  @@map("animales_antidotos")
}

model Hospital {
  id                 Int      @id @default(autoincrement())
  nombre             String
  direccion          String
  telefono           String?
  latitud            Float
  longitud           Float
  ultimaVerificacion DateTime?
  creadoEn           DateTime @default(now())

  hospitalAntidoto HospitalAntidoto[]

  @@map("hospitales")
}

// Relación Hospital <-> Antídoto (Inventario/Stock)
model HospitalAntidoto {
  hospitalId Int
  antidotoId Int
  stock      Int? @default(0)

  hospital Hospital @relation(fields: [hospitalId], references: [id], onDelete: Cascade)
  antidoto Antidoto @relation(fields: [antidotoId], references: [id], onDelete: Cascade)

  @@id([hospitalId, antidotoId])
  @@map("hospitales_antidotos")
}

// ==========================================
// MÓDULO DE INFORMACIÓN (FAQ / AYUDA)
// ==========================================

model Faq {
  id        Int      @id @default(autoincrement())
  pregunta  String
  respuesta String   @db.Text // Permite textos largos para explicaciones detalladas
  orden     Int?     @default(0) // Para controlar qué preguntas salen primero en la UI
  creadoEn  DateTime @default(now())

  @@map("faqs")
}